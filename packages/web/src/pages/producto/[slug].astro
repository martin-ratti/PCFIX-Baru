---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import AddToCart from '../../components/products/AddToCart.tsx';

const { slug } = Astro.params;
let product: any = null;
try {
  const response = await fetch(`http://localhost:3002/api/products/${slug}`);
  if (response.ok) { const result = await response.json(); if (result.success) product = result.data; }
} catch (e) {}
if (!product) return new Response(null, { status: 404 });
---
<Layout title={`PCFIX | ${product.nombre}`}>
  <Header />
  <main class="container mx-auto px-6 py-12">
    <div class="bg-white p-8 rounded-lg shadow-lg grid grid-cols-1 md:grid-cols-5 gap-12 items-start">
      <div class="md:col-span-2 flex justify-center"><img src={product.foto || 'https://placehold.co/600'} alt={product.nombre} class="w-full max-h-[500px] object-contain" /></div>
      <div class="md:col-span-3">
        <h1 class="text-4xl font-black text-primary mb-4">{product.nombre}</h1>
        {product.precioOriginal && Number(product.precioOriginal) > Number(product.precio) ? (
          <div class="mb-6"><p class="text-xl text-gray-400 line-through">${Number(product.precioOriginal).toLocaleString('es-AR')}</p><p class="text-5xl font-black text-red-600">${Number(product.precio).toLocaleString('es-AR')}</p></div>
        ) : (<p class="text-5xl font-black text-primary mb-6">${Number(product.precio).toLocaleString('es-AR')}</p>)}
        <p class="text-lg text-muted mb-8">{product.descripcion}</p>
        <AddToCart client:load stock={product.stock} product={{...product, id: product.id.toString(), price: Number(product.precio), imageUrl: product.foto, imageAlt: product.nombre, slug: product.id.toString(), originalPrice: product.precioOriginal}} />
      </div>
    </div>
  </main>
  <Footer />
</Layout>